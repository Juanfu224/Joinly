<main class="p-dashboard">
  <div class="l-contenedor">
    <!-- Header de página -->
    <header class="p-dashboard__header">
      <div class="p-dashboard__header-content">
        <h1 class="p-dashboard__titulo">Grupos</h1>
        <p class="p-dashboard__subtitulo">Gestiona tus unidades familiares y únete a alguno</p>
      </div>
      <div class="p-dashboard__search">
        <input
          class="p-dashboard__search-input"
          type="search"
          placeholder="Buscar grupos..."
          [formControl]="searchControl"
          aria-label="Buscar grupos"
        />
        @if (hasSearchTerm()) {
          <button
            type="button"
            class="p-dashboard__search-clear"
            (click)="searchControl.setValue('')"
            aria-label="Limpiar búsqueda"
          >
            <app-icon name="x" size="sm" />
          </button>
        }
      </div>
    </header>

    <!-- Tarjetas de acción: Crear / Unirse -->
    <section class="p-dashboard__acciones" aria-label="Acciones de grupo">
      <!-- Crear unidad familiar -->
      <button
        type="button"
        class="u-btn-wrapper"
        (click)="onCreateGroup()"
        aria-label="Crear unidad familiar"
      >
        <app-card variant="action">
          <div slot="icon" class="c-card-icon c-card-icon--naranja c-card-icon--sm">
            <app-icon name="add" size="xl" />
          </div>
          <h3 slot="title">Crear unidad familiar</h3>
          <p slot="description">Empieza un nuevo grupo</p>
        </app-card>
      </button>

      <!-- Unirse a un grupo -->
      <button
        type="button"
        class="u-btn-wrapper"
        (click)="onJoinGroup()"
        aria-label="Unirse a un grupo"
      >
        <app-card variant="action">
          <div slot="icon" class="c-card-icon c-card-icon--azul c-card-icon--sm">
            <app-icon name="home" size="xl" />
          </div>
          <h3 slot="title">Unirse a un grupo</h3>
          <p slot="description">Usa un código de 12 dígitos</p>
        </app-card>
      </button>
    </section>

    <!-- Estado de carga -->
    @if (isLoading()) {
      <section class="p-dashboard__grupos" aria-label="Cargando grupos">
        <div class="p-dashboard__grid">
          @for (i of [1, 2, 3]; track i) {
            <div class="p-dashboard__skeleton" aria-hidden="true">
              <div class="p-dashboard__skeleton-header">
                <div class="p-dashboard__skeleton-title"></div>
                <div class="p-dashboard__skeleton-badge"></div>
              </div>
              <div class="p-dashboard__skeleton-content">
                <div class="p-dashboard__skeleton-label"></div>
                <div class="p-dashboard__skeleton-text"></div>
              </div>
              <div class="p-dashboard__skeleton-footer">
                <div class="p-dashboard__skeleton-button"></div>
              </div>
            </div>
          }
        </div>
      </section>
    } @else if (error()) {
      <!-- Estado de error -->
      <section class="p-dashboard__error" aria-label="Error al cargar">
        <div class="p-dashboard__error-content">
          <app-icon name="alert-triangle" size="lg" />
          <p class="p-dashboard__error-text">{{ error() }}</p>
          <button type="button" class="p-dashboard__error-retry" (click)="recargarGrupos()">
            Reintentar
          </button>
        </div>
      </section>
    } @else {
      <section class="p-dashboard__grupos" aria-label="Mis grupos">
        @if (grupos().length > 0) {
          @if (noResults()) {
            <div class="p-dashboard__no-results">
              <app-icon name="search" size="lg" />
              <p>
                No se encontraron grupos que coincidan con "<strong>{{ searchTerm() }}</strong
                >"
              </p>
              <button
                type="button"
                class="p-dashboard__clear-search"
                (click)="searchControl.setValue('')"
              >
                Limpiar búsqueda
              </button>
            </div>
          } @else {
            <div class="p-dashboard__grid">
              @for (grupo of gruposFiltrados(); track grupo.id) {
                <app-group-card
                  [grupo]="grupo"
                  (invite)="onGroupInvite(grupo.id)"
                  (cardClick)="onGroupClick(grupo.id, grupo)"
                />
              }
            </div>
          }
        } @else {
          <app-empty-groups />
        }
      </section>
    }
  </div>
</main>
