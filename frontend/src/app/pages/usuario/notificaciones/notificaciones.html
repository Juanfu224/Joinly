<article class="p-notificaciones" aria-labelledby="notif-titulo">
  <header class="p-notificaciones__header">
    <h1 id="notif-titulo" class="p-notificaciones__titulo">Notificaciones</h1>
    <p class="p-notificaciones__descripcion">
      Configura qué notificaciones quieres recibir por correo electrónico
    </p>
  </header>

  <form [formGroup]="preferencesForm" (ngSubmit)="onSave()" aria-label="Preferencias de notificaciones">
    <app-card class="p-notificaciones__seccion">
      <header class="p-notificaciones__seccion-header">
        <div class="p-notificaciones__seccion-info">
          <h2 class="p-notificaciones__subtitulo">
            <app-icon name="email" size="sm" aria-hidden="true" />
            Notificaciones por email
          </h2>
          <p class="p-notificaciones__seccion-descripcion">
            Elige qué tipo de correos quieres recibir de Joinly
          </p>
        </div>
        <div class="p-notificaciones__quick-actions" role="group" aria-label="Acciones rápidas">
          <app-button type="button" variant="ghost" size="sm" (click)="onToggleAll(true)">
            Activar todas
          </app-button>
          <app-button type="button" variant="ghost" size="sm" (click)="onToggleAll(false)">
            Desactivar todas
          </app-button>
        </div>
      </header>

      <fieldset class="p-notificaciones__opciones">
        <legend class="u-sr-only">Tipos de notificaciones</legend>
        @for (option of notificationOptions; track option.key) {
          <label class="p-notificaciones__opcion">
            <span class="p-notificaciones__opcion-icon" aria-hidden="true">
              <app-icon [name]="option.icon" size="md" />
            </span>
            <span class="p-notificaciones__opcion-info">
              <span class="p-notificaciones__opcion-titulo">{{ option.title }}</span>
              <span class="p-notificaciones__opcion-descripcion">{{ option.description }}</span>
            </span>
            <app-form-checkbox [formControlName]="option.key" [label]="''" />
          </label>
        }
      </fieldset>
    </app-card>

    <app-card class="p-notificaciones__info-card" [fondoGris]="true">
      <aside class="p-notificaciones__info-content" aria-labelledby="info-notif">
        <app-icon name="info" size="md" aria-hidden="true" />
        <div>
          <p id="info-notif" class="p-notificaciones__info-titulo">Sobre las notificaciones</p>
          <p class="p-notificaciones__info-texto">
            Las notificaciones críticas de seguridad (como cambios de contraseña o accesos sospechosos) 
            siempre se enviarán independientemente de tu configuración.
          </p>
        </div>
      </aside>
    </app-card>

    <footer class="p-notificaciones__footer">
      @if (hasChanges()) {
        <app-button type="button" variant="ghost" (click)="onReset()" [disabled]="isSaving()">
          Descartar cambios
        </app-button>
      }
      <app-button 
        type="submit" 
        variant="primary" 
        leftIcon="check"
        [disabled]="!canSave()" 
        [loading]="isSaving()">
        Guardar preferencias
      </app-button>
    </footer>
  </form>

  @if (isLoading() || isSaving()) {
    <app-spinner-overlay />
  }
</article>
