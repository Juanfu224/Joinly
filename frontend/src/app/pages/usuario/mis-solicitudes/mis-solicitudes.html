<article class="p-mis-solicitudes" aria-labelledby="solicitudes-titulo">
  <header class="p-mis-solicitudes__header">
    <div class="p-mis-solicitudes__header-content">
      <h1 id="solicitudes-titulo" class="p-mis-solicitudes__title">Mis Solicitudes</h1>
      <p class="p-mis-solicitudes__description">
        Gestiona tus solicitudes de unión a grupos y suscripciones
      </p>
    </div>
    <app-button
      variant="secondary"
      leftIcon="sync"
      (click)="onRefresh()"
      [disabled]="isLoading()">
      Actualizar
    </app-button>
  </header>

  <!-- Filtros por estado -->
  <section class="p-mis-solicitudes__filters" aria-label="Filtros de solicitudes">
    <div class="p-mis-solicitudes__filter-label">
      <app-icon name="filter" size="sm" aria-hidden="true" />
      <span>Filtrar por estado:</span>
    </div>
    <div class="p-mis-solicitudes__filter-group" role="group">
      @for (filtro of filtroOptions; track filtro.value) {
        <button
          type="button"
          class="p-mis-solicitudes__filter-btn"
          [class.p-mis-solicitudes__filter-btn--active]="
            (filtro.value === 'TODAS' && filtroEstado() === undefined) ||
            filtroEstado() === filtro.value
          "
          [attr.aria-pressed]="(filtro.value === 'TODAS' && filtroEstado() === undefined) || filtroEstado() === filtro.value"
          (click)="onFiltroChange(filtro.value)">
          <app-icon [name]="filtro.icon" size="xs" aria-hidden="true" />
          <span>{{ filtro.label }}</span>
          @if (filtro.value !== 'TODAS') {
            <span class="p-mis-solicitudes__filter-count" aria-label="{{ getContador(filtro.value) }} solicitudes">
              {{ getContador(filtro.value) }}
            </span>
          }
        </button>
      }
    </div>
  </section>

  <!-- Contenido principal con tabs -->
  <app-tabs class="p-mis-solicitudes__tabs">
    <app-tab title="Grupos ({{ contadoresGrupos().total }})">
      @if (haySolicitudesGrupos()) {
        <ul class="p-mis-solicitudes__grid" role="list">
          @for (solicitud of solicitudesGrupos(); track solicitud.id) {
            <li>
              <app-solicitud-card
                [solicitud]="solicitud"
                (cancel)="onRequestCancel(solicitud)" />
            </li>
          }
        </ul>
      } @else {
        <div class="p-mis-solicitudes__empty" role="status">
          <figure class="p-mis-solicitudes__empty-icon" aria-hidden="true">
            <app-icon name="users" size="xl" />
          </figure>
          <h3 class="p-mis-solicitudes__empty-title">
            {{ filtroEstado() ? 'Sin resultados' : 'No hay solicitudes de grupos' }}
          </h3>
          <p class="p-mis-solicitudes__empty-text">
            @if (filtroEstado()) {
              No tienes solicitudes de grupos con el estado "{{ filtroEstado()?.toLowerCase() }}"
            } @else {
              Aún no has enviado ninguna solicitud para unirte a un grupo familiar.
              Usa un código de invitación para solicitar unirte a uno.
            }
          </p>
          @if (filtroEstado()) {
            <app-button variant="ghost" (click)="onFiltroChange('TODAS')">
              Ver todas las solicitudes
            </app-button>
          }
        </div>
      }
    </app-tab>

    <app-tab title="Suscripciones ({{ contadoresSuscripciones().total }})">
      @if (haySolicitudesSuscripciones()) {
        <ul class="p-mis-solicitudes__grid" role="list">
          @for (solicitud of solicitudesSuscripciones(); track solicitud.id) {
            <li>
              <app-solicitud-card
                [solicitud]="solicitud"
                (cancel)="onRequestCancel(solicitud)" />
            </li>
          }
        </ul>
      } @else {
        <div class="p-mis-solicitudes__empty" role="status">
          <figure class="p-mis-solicitudes__empty-icon" aria-hidden="true">
            <app-icon name="star" size="xl" />
          </figure>
          <h3 class="p-mis-solicitudes__empty-title">
            {{ filtroEstado() ? 'Sin resultados' : 'No hay solicitudes de suscripciones' }}
          </h3>
          <p class="p-mis-solicitudes__empty-text">
            @if (filtroEstado()) {
              No tienes solicitudes de suscripciones con el estado "{{ filtroEstado()?.toLowerCase() }}"
            } @else {
              Aún no has solicitado unirte a ninguna suscripción compartida.
              Explora las suscripciones disponibles en tu grupo.
            }
          </p>
          @if (filtroEstado()) {
            <app-button variant="ghost" (click)="onFiltroChange('TODAS')">
              Ver todas las solicitudes
            </app-button>
          }
        </div>
      }
    </app-tab>
  </app-tabs>

  @if (isLoading()) {
    <app-spinner-overlay />
  }
</article>
