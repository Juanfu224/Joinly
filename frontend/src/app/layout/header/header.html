<header class="c-header" role="banner">
  <div class="c-header__contenedor l-contenedor">
    <!-- Logotipo con enlace a inicio -->
    <a routerLink="/" class="c-header__logo" aria-label="Joinly, ir a la página de inicio">
      <app-logo [variant]="logoVariant()" size="md" />
    </a>

    <!-- Botón menú hamburguesa (solo móvil/tablet) -->
    <button
      #menuButton
      type="button"
      class="c-header__menu-toggle"
      (click)="toggleMenu()"
      [attr.aria-expanded]="menuOpen()"
      aria-label="Menú de navegación"
      aria-controls="mobile-navigation"
    >
      <app-icon [name]="menuOpen() ? 'close' : 'menu'" size="md" />
    </button>

    <!-- Área de utilidad (desktop) -->
    <nav class="c-header__utilidad" aria-label="Acceso de usuario">
      <app-theme-toggle />
      
      <!-- Modo público: Login/Registro -->
      @if (!isAuthenticated()) {
        <a routerLink="/login" class="c-header__btn c-header__btn--secundario">
          Iniciar sesión
        </a>
        <a routerLink="/register" class="c-header__btn c-header__btn--primario">
          Empezar
        </a>
      }
      
      <!-- Modo autenticado: Grupos + Notificaciones + Avatar -->
      @if (isAuthenticated()) {
        <a 
          routerLink="/dashboard" 
          routerLinkActive="c-header__btn--activo" 
          class="c-header__btn c-header__btn--primario"
        >
          Grupos
        </a>
        
        <button
          type="button"
          class="c-header__notificaciones"
          disabled
          aria-label="Notificaciones (próximamente)"
          title="Próximamente"
        >
          <app-icon name="bell" size="md" />
        </button>

        <app-user-dropdown
          [userName]="currentUser()?.nombre || 'Usuario'"
          [userEmail]="currentUser()?.email"
          (logout)="onLogout()"
        />
      }
    </nav>
  </div>

  <!-- Overlay oscuro (solo visible cuando menú móvil está abierto) -->
  <div
    class="c-header__overlay"
    [class.c-header__overlay--visible]="menuOpen()"
    aria-hidden="true"
  ></div>

  <!-- Menú de navegación móvil -->
  <nav
    #mobileMenu
    id="mobile-navigation"
    class="c-header__nav-mobile"
    [class.c-header__nav-mobile--abierto]="menuOpen()"
    aria-label="Navegación principal"
  >
    <ul class="c-header__nav-lista">
      <li class="c-header__nav-item">
        <a routerLink="/" class="c-header__nav-enlace" routerLinkActive="c-header__nav-enlace--activo" [routerLinkActiveOptions]="{exact: true}">
          <app-icon name="home" size="sm" />
          <span>Inicio</span>
        </a>
      </li>
      
      <!-- Solo si está autenticado: Grupos -->
      @if (isAuthenticated()) {
        <li class="c-header__nav-item">
          <a routerLink="/dashboard" class="c-header__nav-enlace" routerLinkActive="c-header__nav-enlace--activo">
            <app-icon name="users" size="sm" />
            <span>Grupos</span>
          </a>
        </li>
      }
      
      <li class="c-header__nav-item">
        <a routerLink="/style-guide" class="c-header__nav-enlace" routerLinkActive="c-header__nav-enlace--activo">
          <app-icon name="pencil" size="sm" />
          <span>Guía de Estilos</span>
        </a>
      </li>
    </ul>

    <!-- Separador visual -->
    <hr class="c-header__nav-separador" />

    <!-- Acciones de usuario en el menú móvil -->
    <div class="c-header__nav-acciones">
      <app-theme-toggle />
      
      <!-- Modo público -->
      @if (!isAuthenticated()) {
        <a routerLink="/login" class="c-header__btn c-header__btn--secundario c-header__btn--block">
          Iniciar sesión
        </a>
        <a routerLink="/register" class="c-header__btn c-header__btn--primario c-header__btn--block">
          Empezar
        </a>
      }
      
      <!-- Modo autenticado -->
      @if (isAuthenticated() && currentUser(); as user) {
        <div class="c-header__user-info">
          <app-avatar [name]="user.nombre" size="sm" />
          <span>{{ user.nombre }}</span>
        </div>
        <button 
          type="button"
          class="c-header__btn c-header__btn--secundario c-header__btn--block"
          (click)="onLogout()"
        >
          Cerrar sesión
        </button>
      }
    </div>
  </nav>
</header>
