# ========================================
# Perfil: prod - Configuración de Producción
# ========================================
# Uso: ./mvnw spring-boot:run -Dspring-boot.run.profiles=prod
# IMPORTANTE: Todas las variables de entorno son OBLIGATORIAS

# Base de datos - Conexión segura
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA/Hibernate - Dialect explícito para MySQL 8.0+
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
# NO validar schema en producción - Flyway maneja las migraciones
spring.jpa.hibernate.ddl-auto=none

# Logging mínimo
logging.level.root=WARN
logging.level.com.alberti.joinly=INFO
logging.level.org.springframework.web=WARN
logging.level.org.springframework.security=WARN
logging.level.org.flywaydb=DEBUG

# CORS - Dominios de producción (OBLIGATORIO definir)
cors.allowed-origins[0]=${CORS_ALLOWED_ORIGIN}

# Seguridad - Ocultar información sensible en errores
spring.web.error.whitelabel.enabled=false
spring.web.error.include-message=never
spring.web.error.include-binding-errors=never
spring.web.error.include-stacktrace=never
spring.web.error.include-exception=false

# Seguridad - Headers HTTP
server.compression.enabled=true
server.http2.enabled=true

# Actuator - Producción (solo endpoints esenciales)
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true

# Optimización - Conexiones keep-alive
server.tomcat.keep-alive-timeout=60000
server.tomcat.max-keep-alive-requests=100

# Thread pool (Virtual Threads ya habilitado en application.properties)
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
